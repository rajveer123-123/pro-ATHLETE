<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recovery Pro - Athlete Elite Analytics</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #1e40af; --practice: #059669; --main: #dc2626; --bg: #f1f5f9; --ai-gold: #7c3aed; }
        body { font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg); margin: 0; padding-top: 65px; }
        
        /* Navigation Bar */
        .nav { position: fixed; top: 0; width: 100%; background: #fff; display: flex; border-bottom: 1px solid #e2e8f0; z-index: 1000; height: 60px; overflow-x: auto; scrollbar-width: none; }
        .nav-btn { min-width: 90px; flex: 1; padding: 18px 5px; text-align: center; font-size: 11px; font-weight: bold; color: #64748b; cursor: pointer; border: none; background: none; text-transform: uppercase; }
        .nav-btn.active { color: var(--primary); border-bottom: 3px solid var(--primary); background: #f0f7ff; }

        .container { padding: 15px; display: none; max-width: 650px; margin: auto; }
        .container.active { display: block; }

        /* Professional Cards */
        .card { background: white; padding: 20px; border-radius: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #e2e8f0; position: relative; }
        input, select, textarea { width: 100%; padding: 14px; margin: 8px 0; border: 1px solid #e2e8f0; border-radius: 14px; font-size: 16px; box-sizing: border-box; background: #f8fafc; }
        .btn { width: 100%; padding: 16px; border: none; border-radius: 14px; font-weight: bold; color: white; cursor: pointer; font-size: 16px; margin-top: 10px; transition: 0.2s; }
        
        /* Analytics Dashboard Elements */
        .scroll-x { display: flex; overflow-x: auto; gap: 12px; padding: 10px 0; scrollbar-width: none; }
        .graph-card { min-width: 310px; background: #fff; border: 1px solid #eee; border-radius: 20px; padding: 15px; margin-right: 12px; }
        .ath-chip { padding: 10px 20px; background: #fff; border: 1px solid #ddd; border-radius: 30px; font-size: 12px; cursor: pointer; white-space: nowrap; font-weight: 600; }
        .ath-chip.selected { background: var(--primary); color: white; border-color: var(--primary); }

        /* AI Summary Report Styling */
        .report-summary { background: #f5f3ff; border-left: 5px solid var(--ai-gold); padding: 15px; border-radius: 12px; margin-top: 15px; font-size: 13px; color: #4c1d95; line-height: 1.5; }
        .pb-badge { background: #fffbeb; border: 1px solid #fbbf24; padding: 4px 10px; border-radius: 10px; font-size: 11px; font-weight: bold; color: #92400e; display: inline-block; margin-bottom: 10px; }
        
        canvas { max-height: 250px; margin: 10px 0; }
        .del-btn { color: #ef4444; background: none; border: none; cursor: pointer; font-size: 11px; text-decoration: underline; }
    </style>
</head>
<body>

    <div class="nav">
        <div class="nav-btn active" onclick="showTab('p-page', this)">PRACTICE</div>
        <div class="nav-btn" onclick="showTab('m-page', this)">OFFICIAL</div>
        <div class="nav-btn" onclick="showTab('d-page', this)">ANALYTICS</div>
        <div class="nav-btn" onclick="showTab('a-page', this)">RECOVERY AI</div>
        <div class="nav-btn" onclick="showTab('v-page', this)">REVIEWS</div>
    </div>

    <div id="p-page" class="container active">
        <div class="card">
            <h2>üèÉ Practice Entry</h2>
            <input type="text" id="pName" placeholder="Athlete Name">
            <select id="pDrill">
                <option>30m Sprint</option><option>60m Sprint</option><option>Broad Jump</option><option>150m Pace</option>
            </select>
            <input type="number" step="0.01" id="pScore" placeholder="Score">
            <input type="date" id="pDate">
            <button class="btn" style="background: var(--practice)" onclick="saveData('Practice')">SAVE PRACTICE</button>
        </div>
        <div id="practice-live-view"></div>
    </div>

    <div id="m-page" class="container">
        <div class="card">
            <h2>üèÜ Official Trial</h2>
            <input type="text" id="mName" placeholder="Athlete Name">
            <select id="mEvent">
                <option>100m Sprint</option><option>200m Sprint</option><option>Long Jump</option><option>Shot Put</option>
            </select>
            <input type="number" step="0.01" id="mScore" placeholder="Score">
            <input type="date" id="mDate">
            <button class="btn" style="background: var(--main)" onclick="saveData('Main')">SAVE OFFICIAL</button>
        </div>
        <div id="main-live-view"></div>
    </div>

    <div id="d-page" class="container">
        <h2 style="text-align:center">üìä Analytics & Progress Chart</h2>
        <div id="athFilter" class="scroll-x"></div>
        <div id="displayArea"></div>
    </div>

    <div id="a-page" class="container">
        <h2 style="color: var(--ai-gold); text-align: center;">ü§ñ Recovery Pro AI</h2>
        <div id="lock-screen" class="card" style="text-align: center;">
            <h3>Premium Coaching Locked üîí</h3>
            <input type="text" id="actCode" placeholder="Enter Pin (1234)">
            <button class="btn" style="background: var(--ai-gold)" onclick="unlockPremium()">UNLOCK AI</button>
        </div>
        <div id="ai-content" style="display:none;">
            <div class="card">
                <h4>üí¨ 24/7 Coach Chat</h4>
                <div id="chat-wall" style="height: 180px; overflow-y: auto; background: #f8fafc; padding: 10px; border-radius: 12px; margin-bottom: 10px; font-size: 13px;"></div>
                <div style="display:flex; gap:5px;"><input type="text" id="chat-in" style="margin:0;"><button class="btn" style="width:60px; margin:0; background: var(--ai-gold)" onclick="askAI()">ASK</button></div>
            </div>
        </div>
    </div>

    <div id="v-page" class="container">
        <h2>üí¨ Live Global Reviews (<span id="revCount">0</span>)</h2>
        <div class="card">
            <input type="text" id="revName" placeholder="Your Name">
            <select id="revStars"><option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option><option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option><option value="3">‚≠ê‚≠ê‚≠ê</option></select>
            <textarea id="revText" placeholder="Post feedback..."></textarea>
            <button class="btn" style="background: var(--ai-gold)" onclick="submitReview()">POST REVIEW</button>
        </div>
        <div id="reviewWall"></div>
    </div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyBXlSIIG2czsrKYMJ07H7ibhXqd7jpOQR0", databaseURL: "https://athletetracker-5efd6-default-rtdb.firebaseio.com" };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let devID = localStorage.getItem('athlete_dev_id') || 'D-' + Math.random().toString(36).substr(2, 9);
    localStorage.setItem('athlete_dev_id', devID);
    const ID = 'Elite_' + devID;
    let selectedAthlete = "All";
    let charts = {};

    function showTab(id, btn) {
        document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
        if(localStorage.getItem('premium_active') === 'true') checkSub();
    }

    function unlockPremium() { if(document.getElementById('actCode').value==='1234'){ localStorage.setItem('premium_active','true'); checkSub(); } }
    function checkSub() { document.getElementById('lock-screen').style.display = 'none'; document.getElementById('ai-content').style.display = 'block'; }

    function saveData(type) {
        const p = type === 'Practice' ? 'p' : 'm';
        const name = document.getElementById(p+'Name').value.trim();
        const event = document.getElementById(p+(type==='Practice'?'Drill':'Event')).value;
        const score = document.getElementById(p+'Score').value;
        const date = document.getElementById(p+'Date').value;
        if(name && score && date) db.ref(`${ID}/data/${name}/${type}/${event.replace(/\s/g,'-')}`).push({ score, date, ts: Date.now(), event });
    }

    // AI Summary Generation Logic
    function getSummary(name, event, scores, dates) {
        const isSprint = event.includes("Sprint") || event.includes("m");
        const best = isSprint ? Math.min(...scores) : Math.max(...scores);
        const last = scores[scores.length-1];
        return `<b>AI Report for ${name}:</b> Is event (${event}) mein aapka best <b>${best}</b> raha hai. 
                Last session (${dates[dates.length-1]}) mein aapne <b>${last}</b> kiya. 
                Performance abhi ${last == best ? 'peak par hai' : 'thodi slow hai'}. 
                <b>Diet Tip:</b> Carbohydrates badhayein explosive power ke liye.`;
    }

    db.ref(`${ID}/data`).on('value', snap => {
        const pV = document.getElementById('practice-live-view'); const mV = document.getElementById('main-live-view'); 
        const dash = document.getElementById('displayArea'); const filter = document.getElementById('athFilter');
        pV.innerHTML = ''; mV.innerHTML = ''; dash.innerHTML = ''; const data = snap.val(); if(!data) return;

        filter.innerHTML = `<div class="chip ${selectedAthlete==='All'?'selected':''}" onclick="selectedAthlete='All'">All View</div>`;
        Object.keys(data).forEach(a => { filter.innerHTML += `<div class="ath-chip ${selectedAthlete===a?'selected':''}" onclick="selectedAthlete='${a}'">${a}</div>`; });

        for(let n in data) {
            if(selectedAthlete !== "All" && selectedAthlete !== n) continue;
            const aCard = document.createElement('div'); aCard.className = 'card';
            aCard.innerHTML = `<h3>üë§ Athlete: ${n}</h3>`;
            
            for(let cat in data[n]) {
                for(let evKey in data[n][cat]) {
                    const logs = Object.entries(data[n][cat][evKey]).map(([k, v]) => ({key: k, ...v})).sort((a,b)=>a.ts-b.ts);
                    const scores = logs.map(l => parseFloat(l.score));
                    const dates = logs.map(l => l.date);
                    const isSprint = evKey.includes("Sprint") || evKey.includes("m");
                    const pb = isSprint ? Math.min(...scores) : Math.max(...scores);
                    
                    const gId = `g-${n}-${evKey}`.replace(/\s+/g,'-');
                    const gCard = document.createElement('div'); gCard.className = 'graph-card';
                    gCard.innerHTML = `<b>${evKey}</b> <span class="pb-badge">‚≠ê PB: ${pb}</span><canvas id="${gId}"></canvas>
                                       <div class="report-summary">${getSummary(n, evKey, scores, dates)}</div>`;
                    
                    dash.appendChild(gCard);
                    setTimeout(() => {
                        new Chart(document.getElementById(gId), {
                            type: 'line',
                            data: { labels: dates, datasets: [{ data: scores, borderColor: '#1e40af', tension:0.4, fill: true, backgroundColor:'rgba(30,64,175,0.05)' }] },
                            options: { plugins: { legend: { display: false } }, scales: { y: { reverse: isSprint } } }
                        });
                    }, 500);
                }
            }
            dash.appendChild(aCard);
        }
    });

    function submitReview() { const n = document.getElementById('revName').value; const s = document.getElementById('revStars').value; const m = document.getElementById('revText').value; if(n && m) db.ref(`GLOBAL_REVIEWS`).push({ name: n, rating: s, msg: m }); }
    db.ref(`GLOBAL_REVIEWS`).on('value', snap => {
        const wall = document.getElementById('reviewWall'); document.getElementById('revCount').innerText = snap.numChildren();
        wall.innerHTML = ''; snap.forEach(c => { const d = c.val(); wall.innerHTML = `<div class="card"><b>${d.name}</b> ${'‚≠ê'.repeat(d.rating)}<p>${d.msg}</p></div>` + wall.innerHTML; });
    });
</script>
</body>
</html>
