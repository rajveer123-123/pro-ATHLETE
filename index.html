<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Performance Pro AI - v33</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #2563eb; --practice: #059669; --main: #dc2626; --bg: #f8fafc; --premium: #7c3aed; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-top: 65px; }
        .nav { position: fixed; top: 0; width: 100%; background: #fff; display: flex; border-bottom: 1px solid #e2e8f0; z-index: 1000; height: 60px; overflow-x: auto; }
        .nav-btn { min-width: 90px; flex: 1; padding: 20px 5px; text-align: center; font-size: 11px; font-weight: bold; color: #64748b; cursor: pointer; border: none; background: none; }
        .nav-btn.active { color: var(--primary); border-bottom: 3px solid var(--primary); background: #f0f7ff; }
        .container { padding: 15px; display: none; max-width: 600px; margin: auto; }
        .container.active { display: block; }
        .card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 16px; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; color: white; cursor: pointer; font-size: 16px; margin-top: 10px; }
        .paywall { display: none; text-align: center; padding: 40px 20px; background: #fff; border: 2px solid var(--premium); border-radius: 25px; }
        .athlete-card { background: white; border-radius: 25px; margin-bottom: 30px; padding: 20px; border-left: 10px solid var(--primary); }
        .scroll-x { display: flex; overflow-x: auto; gap: 20px; padding: 10px 0; }
        .graph-card { min-width: 310px; background: #fff; border: 1px solid #f1f5f9; border-radius: 20px; padding: 15px; }
        .ai-box { background:#f0f7ff; padding:12px; border-radius:12px; font-size:13px; margin-top:10px; border-left: 4px solid var(--primary); line-height: 1.5; }
        
        /* New Chat UI */
        #chat-container { height: 200px; overflow-y: auto; background: #f1f5f9; padding: 10px; border-radius: 12px; margin-top: 10px; }
        .msg { margin-bottom: 8px; padding: 8px; border-radius: 8px; font-size: 13px; }
        .msg-bot { background: #dbeafe; border-left: 3px solid var(--primary); }
        .msg-user { background: #fff; text-align: right; }
    </style>
</head>
<body>

    <div class="nav">
        <div class="nav-btn active" onclick="showTab('page-practice', this)">PRACTICE</div>
        <div class="nav-btn" onclick="showTab('page-main', this)">MAIN</div>
        <div class="nav-btn" onclick="showTab('page-dash', this)">DASHBOARD</div>
        <div class="nav-btn" onclick="showTab('page-reports', this)">AI PREMIUM</div>
    </div>

    <div id="page-practice" class="container active">
        <h2 style="color: var(--practice)">üèÉ Training Session</h2>
        <div class="card">
            <input type="text" id="pName" placeholder="Athlete Name">
            <select id="pDrill">
                <option>30m Sprint</option><option>80m Sprint</option><option>150m Sprint</option><option>300m Sprint</option>
                <option>Broad Jump</option><option>5 Bonded Jumps</option><option>10 Bonded Jumps</option>
                <option>Medicine Ball Throw</option><option>Back Throw</option>
            </select>
            <input type="number" step="0.01" id="pScore" placeholder="Result">
            <input type="date" id="pDate">
            <button class="btn" style="background: var(--practice)" onclick="saveData('Practice')">SAVE DATA</button>
        </div>
    </div>

    <div id="page-main" class="container">
        <h2 style="color: var(--main)">üèÜ Official Trials</h2>
        <div class="card">
            <input type="text" id="mName" placeholder="Athlete Name">
            <select id="mEvent">
                <option>100m Dash</option><option>200m Dash</option><option>400m Dash</option>
                <option>Long Jump</option><option>Triple Jump</option><option>Shot Put</option>
            </select>
            <input type="number" step="0.01" id="mScore" placeholder="Result">
            <input type="date" id="mDate">
            <button class="btn" style="background: var(--main)" onclick="saveData('Main')">SAVE EVENT</button>
        </div>
    </div>

    <div id="page-reports" class="container">
        <h2 onclick="adminCheck()" style="color: var(--premium)">üìú AI Career Roadmap & Chat</h2>
        
        <div id="paywall-screen" class="paywall">
            <h3>Premium Content Locked üîí</h3>
            <p>Access Career Goals & 24/7 AI Sport Bot.</p>
            <button class="btn" style="background:var(--premium)" onclick="alert('Please pay via UPI to unlock')">PAY TO UNLOCK</button>
            <input type="text" id="userUtr" placeholder="Enter Transaction ID" style="margin-top:10px">
            <button class="btn" style="background:#22c55e" onclick="submitPayment()">SUBMIT ID</button>
        </div>

        <div id="reports-list" style="display:none;">
            <div class="card">
                <h3>ü§ñ 24/7 Sports Assistant</h3>
                <div id="chat-container">
                    <div class="msg msg-bot">Hello! I am your AI Sports Expert. Ask me about training, injury or diet.</div>
                </div>
                <div style="display:flex; gap:5px; margin-top:10px;">
                    <input type="text" id="chat-input" placeholder="Ask anything...">
                    <button class="btn" style="width:70px; margin:0; background:var(--premium)" onclick="askChatBot()">ASK</button>
                </div>
            </div>
            <div id="athlete-career-reports"></div>
        </div>
    </div>

    <div id="page-dash" class="container">
        <h2>üìä Performance Dashboard</h2>
        <div id="displayArea"></div>
    </div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyBXlSIIG2czsrKYMJ07H7ibhXqd7jpOQR0", databaseURL: "https://athletetracker-5efd6-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    let userID = 'user_v33_ai';
    let installDate = localStorage.getItem('install_date') || Date.now();
    localStorage.setItem('install_date', installDate);

    function showTab(id, btn) {
        document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
        if(id === 'page-reports') checkSubscription();
    }

    function checkSubscription() {
        const isUnlocked = localStorage.getItem('premium_unlocked');
        const daysUsed = Math.floor((Date.now() - parseInt(installDate)) / (1000*60*60*24));
        if (isUnlocked === 'true' || daysUsed < 30) {
            document.getElementById('reports-list').style.display = 'block';
            document.getElementById('paywall-screen').style.display = 'none';
        } else {
            document.getElementById('reports-list').style.display = 'none';
            document.getElementById('paywall-screen').style.display = 'block';
        }
    }

    function submitPayment() {
        if(document.getElementById('userUtr').value.length > 5) {
            localStorage.setItem('premium_unlocked', 'true');
            alert("Unlocked! Welcome to Premium AI.");
            location.reload();
        }
    }

    function askChatBot() {
        const q = document.getElementById('chat-input').value;
        if(!q) return;
        const box = document.getElementById('chat-container');
        box.innerHTML += `<div class="msg msg-user">${q}</div>`;
        
        let ans = "Based on your data, focus on core strength. For recovery, use ice baths and 8 hours sleep.";
        if(q.toLowerCase().includes("injury")) ans = "If it's sharp pain, follow RICE (Rest, Ice, Compression, Elevation). Consult a physio if it lasts >3 days.";
        if(q.toLowerCase().includes("diet")) ans = "Eat high protein (eggs, chicken/paneer) 2 hours after training and complex carbs before.";
        
        setTimeout(() => {
            box.innerHTML += `<div class="msg msg-bot"><b>AI:</b> ${ans}</div>`;
            box.scrollTop = box.scrollHeight;
        }, 600);
        document.getElementById('chat-input').value = "";
    }

    function saveData(type) {
        const pre = type === 'Practice' ? 'p' : 'm';
        const name = document.getElementById(pre+'Name').value.trim();
        const event = document.getElementById(pre+(type==='Practice'?'Drill':'Event')).value;
        const date = document.getElementById(pre+'Date').value;
        const score = parseFloat(document.getElementById(pre+'Score').value);
        if(!name || !date || isNaN(score)) return alert("Fill all fields");
        db.ref(`${userID}/data/${name}/${event.replace(/\s/g,'')}`).push({ type, event, date, score, ts: Date.now() });
        alert("Data Saved!");
    }

    db.ref(`${userID}/data`).on('value', snap => {
        const area = document.getElementById('displayArea');
        const rList = document.getElementById('athlete-career-reports');
        area.innerHTML = ''; rList.innerHTML = '';
        const data = snap.val(); if(!data) return;

        for(let name in data) {
            const card = document.createElement('div'); card.className = 'athlete-card';
            card.innerHTML = `<strong>üë§ ${name}</strong><div class="scroll-x" id="sc-${name.replace(/\s/g,'')}"></div>`;
            area.appendChild(card);
            
            let careerGoal = "Targeting District Level. Needs 10% improvement for State.";
            let reportHTML = `<div class="card"><h4>üéØ Career Goal: ${name}</h4><p style="font-size:13px; color:#444">`;

            for(let eKey in data[name]) {
                const logs = Object.values(data[name][eKey]).sort((a,b)=>a.ts - b.ts);
                const latest = logs[logs.length-1];
                reportHTML += `<b>${latest.event}:</b> ${careerGoal}<br>`;
                
                const gCard = document.createElement('div'); gCard.className = 'graph-card';
                gCard.innerHTML = `<small>${latest.event}</small><canvas id="c-${name.replace(/\s/g,'')}-${eKey}"></canvas>`;
                document.getElementById(`sc-${name.replace(/\s/g,'')}`).appendChild(gCard);
                
                setTimeout(() => {
                    new Chart(document.getElementById(`c-${name.replace(/\s/g,'')}-${eKey}`), {
                        type: 'line',
                        data: { labels: logs.map(l=>l.date), datasets: [{ data: logs.map(l=>l.score), borderColor: '#2563eb', tension:0.3 }] },
                        options: { scales:{x:{display:false}}, plugins:{legend:{display:false}} }
                    });
                }, 100);
            }
            reportHTML += `</p></div>`;
            rList.innerHTML += reportHTML;
        }
    });

    function adminCheck() {
        if(prompt("Admin Code:") === "1234") {
            let upi = prompt("Enter New UPI ID:");
            if(upi) localStorage.setItem('owner_upi', upi);
        }
    }
</script>
</body>
</html>
