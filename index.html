<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recovery Pro - Ultimate Athlete Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #1e40af; --practice: #059669; --main: #dc2626; --bg: #f1f5f9; --ai-purple: #7c3aed; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; padding-top: 65px; overflow-x: hidden; }
        
        /* Navigation */
        .nav { position: fixed; top: 0; width: 100%; background: #fff; display: flex; box-shadow: 0 2px 8px rgba(0,0,0,0.1); z-index: 1000; height: 60px; overflow-x: auto; scrollbar-width: none; }
        .nav-btn { min-width: 85px; flex: 1; padding: 20px 5px; text-align: center; font-size: 10px; font-weight: bold; color: #64748b; cursor: pointer; border: none; background: none; text-transform: uppercase; }
        .nav-btn.active { color: var(--primary); border-bottom: 4px solid var(--primary); background: #f0f7ff; }

        .container { padding: 15px; display: none; max-width: 850px; margin: auto; }
        .container.active { display: block; }

        /* Athlete Cards & Scroller */
        .card { background: white; padding: 20px; border-radius: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 25px; border: 1px solid #e2e8f0; position: relative; }
        .event-scroller { display: flex; overflow-x: auto; gap: 15px; padding: 5px; scrollbar-width: none; }
        .event-box { min-width: 310px; background: #fff; border: 1px solid #f1f5f9; border-radius: 20px; padding: 15px; flex-shrink: 0; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
        
        /* Form Elements */
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 16px; background: #f8fafc; box-sizing: border-box; }
        .btn-save { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; color: white; cursor: pointer; font-size: 16px; margin-top: 10px; }
        
        /* Tables & Charts */
        .data-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 12px; }
        .data-table th, .data-table td { text-align: left; padding: 8px; border-bottom: 1px solid #f1f5f9; }
        .pb-tag { background: #fffbeb; border: 1px solid #fbbf24; padding: 3px 8px; border-radius: 8px; font-size: 10px; font-weight: bold; color: #92400e; }
        .del-btn { color: #ef4444; border: none; background: none; cursor: pointer; font-weight: bold; font-size: 10px; }
        .profile-del { position: absolute; top: 20px; right: 20px; background: #fee2e2; color: #dc2626; border: none; padding: 6px 12px; border-radius: 10px; font-size: 10px; cursor: pointer; }
        
        canvas { max-height: 180px; width: 100% !important; margin: 10px 0; }
        
        /* AI Chat UI Upgraded */
        #chat-window { height: 300px; overflow-y: auto; background: #f8fafc; padding: 15px; border-radius: 15px; border: 1px solid #eee; display: flex; flex-direction: column; gap: 10px; }
        .msg { max-width: 85%; padding: 12px 16px; border-radius: 18px; font-size: 13px; line-height: 1.5; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .msg-user { align-self: flex-end; background: var(--primary); color: white; border-bottom-right-radius: 2px; }
        .msg-bot { align-self: flex-start; background: #ede9fe; color: #4c1d95; border-bottom-left-radius: 2px; border-left: 4px solid var(--ai-purple); }
        
        /* Review Extras */
        .live-count-badge { background: var(--ai-purple); color: white; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="nav">
        <div class="nav-btn active" onclick="showTab('p-page', this)">PRACTICE</div>
        <div class="nav-btn" onclick="showTab('m-page', this)">OFFICIAL</div>
        <div class="nav-btn" onclick="showTab('d-page', this)">ANALYTICS</div>
        <div class="nav-btn" onclick="showTab('a-page', this)">AI COACH</div>
        <div class="nav-btn" onclick="showTab('v-page', this)">REVIEWS</div>
    </div>

    <div id="p-page" class="container active">
        <div class="card">
            <h3>üèÉ Practice Log Entry</h3>
            <input type="text" id="pName" placeholder="Athlete Name">
            <select id="pDrill">
                <optgroup label="Sprints (Time)">
                    <option>30m</option><option>40m</option><option>60m</option><option>80m</option>
                    <option>120m</option><option>150m</option><option>180m</option><option>300m</option>
                </optgroup>
                <optgroup label="Jumps (Distance)">
                    <option>Board Jump</option><option>Triple Jump</option><option>Standing Triple</option>
                    <option>5 Bounded</option><option>10 Bounded</option>
                </optgroup>
                <optgroup label="Throws">
                    <option>Ball Throw</option><option>Back Throw</option>
                </optgroup>
            </select>
            <input type="number" step="0.01" id="pScore" placeholder="Result (s or m)">
            <input type="date" id="pDate">
            <button class="btn-save" style="background: var(--practice)" onclick="saveData('Practice')">SAVE PRACTICE</button>
        </div>
        <div id="practice-display"></div>
    </div>

    <div id="m-page" class="container">
        <div class="card">
            <h3>üèÜ Official Trial</h3>
            <input type="text" id="mName" placeholder="Athlete Name">
            <select id="mEvent">
                <optgroup label="Track Events (Running)">
                    <option value="100m">100 Metre</option>
                    <option value="200m">200 Metre</option>
                    <option value="400m">400 Metre</option>
                    <option value="800m">800 Metre</option>
                </optgroup>
                <optgroup label="Jumping Events">
                    <option value="long-jump">Long Jump</option>
                    <option value="high-jump">High Jump</option>
                    <option value="triple-jump">Triple Jump</option>
                </optgroup>
                <optgroup label="Throwing Events">
                    <option value="javelin-throw">Javelin Throw</option>
                    <option value="shot-put">Shot Put</option>
                </optgroup>
            </select>
            <input type="number" step="0.01" id="mScore" placeholder="Result">
            <input type="date" id="mDate">
            <button class="btn-save" style="background: var(--main)" onclick="saveData('Main')">SAVE OFFICIAL TRIAL</button>
        </div>
        <div id="main-display"></div>
    </div>

    <div id="d-page" class="container">
        <h2 style="text-align:center">üìà Progress Dashboard</h2>
        <div id="analytics-display"></div>
    </div>

    <div id="a-page" class="container">
        <div class="card" id="lock-screen">
            <h3>AIA Premium Coach üîí</h3>
            <input type="text" id="pin" placeholder="Enter PIN (1234)">
            <button class="btn-save" style="background: var(--ai-purple)" onclick="unlockAI()">UNLOCK AI</button>
        </div>
        <div id="ai-interface" style="display:none;">
            <div class="card">
                <h4>ü§ñ AIA Smart Coach (Contextual Logic)</h4>
                <div id="chat-window">
                    <div class="msg msg-bot">Namaste! Main AIA Coach hoon. Aap mujhse Injury Recovery, Stamina, Diet ya Speed drills ke baare mein detail mein pooch sakte hain.</div>
                </div>
                <div style="display:flex; gap:10px; margin-top:10px;">
                    <input type="text" id="chat-in" placeholder="Ask specific questions..."><button class="btn-save" style="width:70px; margin:0; background: var(--ai-purple)" onclick="askAdvancedCoach()">ASK</button>
                </div>
            </div>
            <div class="card">
                <button class="btn-save" style="background: var(--primary)" onclick="genMonthlyReport()">GENERATE MONTHLY AUDIT</button>
                <div id="report-output" style="margin-top:10px; display:none; background:#f5f3ff; padding:15px; border-radius:15px; font-size:13px; color:#4c1d95;"></div>
            </div>
        </div>
    </div>

    <div id="v-page" class="container">
        <div style="text-align:center; margin-bottom:15px;">
            <span class="live-count-badge">LIVE FEEDBACKS: <span id="revCount">0</span></span>
        </div>
        <div class="card">
            <h3>üí¨ Global Experience Review</h3>
            <input type="text" id="revName" placeholder="Your Name">
            <select id="revRole">
                <option value="Student">Athlete / Student</option>
                <option value="Coach">Professional Coach</option>
                <option value="Follower">Academy Supporter</option>
            </select>
            <label style="font-size:12px; color:#64748b; font-weight:bold;">Rate Performance (1-5 Stars):</label>
            <select id="revStars" style="background:#fffbeb; border:1px solid #fbbf24;">
                <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excellent (Elite)</option>
                <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê Very Good</option>
                <option value="3">‚≠ê‚≠ê‚≠ê Good</option>
                <option value="2">‚≠ê‚≠ê Fair</option>
                <option value="1">‚≠ê Needs Work</option>
            </select>
            <textarea id="revText" placeholder="How was your training today? Write detail feedback..."></textarea>
            <button class="btn-save" style="background: var(--ai-purple)" onclick="submitReview()">POST GLOBAL REVIEW</button>
        </div>
        <div id="reviewWall"></div>
    </div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyBXlSIIG2czsrKYMJ07H7ibhXqd7jpOQR0", databaseURL: "https://athletetracker-5efd6-default-rtdb.firebaseio.com" };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let devID = localStorage.getItem('athlete_dev_id') || 'D-' + Math.random().toString(36).substr(2, 9);
    localStorage.setItem('athlete_dev_id', devID);
    const ID = 'Elite_' + devID;
    let charts = {};

    function showTab(id, btn) {
        document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
        if(localStorage.getItem('premium_unlocked') === 'true') {
            document.getElementById('lock-screen').style.display = 'none';
            document.getElementById('ai-interface').style.display = 'block';
        }
    }

    function unlockAI() { if(document.getElementById('pin').value==='1234'){ localStorage.setItem('premium_unlocked','true'); location.reload(); } }

    function saveData(type) {
        const pre = type === 'Practice' ? 'p' : 'm';
        const n = document.getElementById(pre+'Name').value.trim();
        const e = document.getElementById(pre+(type==='Practice'?'Drill':'Event')).value;
        const s = document.getElementById(pre+'Score').value;
        const d = document.getElementById(pre+'Date').value;
        if(n && s && d) {
            db.ref(`${ID}/data/${n}/${type}/${e.replace(/\s/g,'-')}`).push({ score: s, date: d, ts: Date.now() });
            document.getElementById(pre+'Score').value = '';
        }
    }

    function deleteRecord(n, c, e, id) { if(confirm("Delete entry?")) db.ref(`${ID}/data/${n}/${c}/${e}/${id}`).remove(); }
    function deleteAthlete(n) { if(confirm("Delete entire profile?")) db.ref(`${ID}/data/${n}`).remove(); }

    db.ref(`${ID}/data`).on('value', snap => {
        const pDisp = document.getElementById('practice-display');
        const mDisp = document.getElementById('main-display');
        const dDisp = document.getElementById('analytics-display');
        pDisp.innerHTML = ''; mDisp.innerHTML = ''; dDisp.innerHTML = '';
        const data = snap.val(); if(!data) return;

        for(let n in data) {
            for(let cat in data[n]) {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `<button class="profile-del" onclick="deleteAthlete('${n}')">DELETE</button>
                                  <div style="font-size:18px; font-weight:800; margin-bottom:15px;">üë§ ${n} (${cat})</div>
                                  <div class="event-scroller" id="scroll-${n}-${cat}"></div>`;
                
                for(let evKey in data[n][cat]) {
                    const logs = Object.entries(data[n][cat][evKey]).map(([id,v])=>({id,...v})).sort((a,b)=>new Date(a.date)-new Date(b.date));
                    const scores = logs.map(l => parseFloat(l.score));
                    const isTime = evKey.toLowerCase().includes('m') || evKey.toLowerCase().includes('sprint');
                    const pb = isTime ? Math.min(...scores) : Math.max(...scores);
                    const gid = `chart-${n}-${cat}-${evKey}`.replace(/\s+/g,'-');

                    const box = document.createElement('div');
                    box.className = 'event-box';
                    box.innerHTML = `<div style="display:flex; justify-content:space-between"><strong>${evKey.replace(/-/g,' ')}</strong> <span class="pb-tag">PB: ${pb}</span></div>
                                     <canvas id="${gid}"></canvas>
                                     <table class="data-table"><thead><tr><th>Date</th><th>Score</th><th></th></tr></thead>
                                     <tbody>${logs.map(l => `<tr><td>${l.date}</td><td><b>${l.score}</b></td><td><button class="del-btn" onclick="deleteRecord('${n}','${cat}','${evKey}','${l.id}')">X</button></td></tr>`).join('')}</tbody></table>`;
                    card.querySelector('.event-scroller').appendChild(box);
                    setTimeout(() => renderChart(gid, logs.map(l=>l.date), scores, isTime), 500);
                }
                if(cat==='Practice') pDisp.appendChild(card);
                else { mDisp.appendChild(card); dDisp.appendChild(card.cloneNode(true)); }
            }
        }
    });

    function renderChart(id, labels, data, rev) {
        const ctx = document.getElementById(id); if(!ctx) return;
        if(charts[id]) charts[id].destroy();
        charts[id] = new Chart(ctx, {
            type: 'line',
            data: { labels: labels, datasets: [{ data: data, borderColor: '#1e40af', backgroundColor: 'rgba(30,64,175,0.05)', fill: true, tension: 0.4 }] },
            options: { plugins: { legend: { display: false } }, scales: { y: { reverse: rev } } }
        });
    }

    // SUPER ADVANCED AI COACH LOGIC
    function askAdvancedCoach() {
        const i = document.getElementById('chat-in'); const w = document.getElementById('chat-window');
        const query = i.value.toLowerCase(); if(!query) return;
        w.innerHTML += `<div class="msg msg-user">${i.value}</div>`;
        i.value = '';

        setTimeout(() => {
            let reply = "Aapki consistency track ho rahi hai. Focus maintain rakhein.";
            if(query.includes("injury") || query.includes("pain") || query.includes("recovery")) {
                reply = "<b>üöë Injury Recovery:</b> Agar pain sharp hai toh 'RICE' method follow karein. Mobility exercises karein par loading kam rakhein. Protein intake badhayein recovery tez hogi.";
            } else if(query.includes("endurance") || query.includes("stamina") || query.includes("long distance")) {
                reply = "<b>üîã Stamina Building:</b> Iske liye hafte mein 1 long run (low heart rate) aur interval tempo runs zaroori hain. Aerobic capacity badhane ke liye core stability par focus karein.";
            } else if(query.includes("diet") || query.includes("protein") || query.includes("nutrition")) {
                reply = "<b>üçé Nutrition Tip:</b> Training se pehle complex carbs (Oats/Banana) aur post-training High Protein (Eggs/Paneer) recovery ke liye lein. Hydration levels check karein.";
            } else if(query.includes("speed") || query.includes("tez") || query.includes("sprint")) {
                reply = "<b>‚ö° Speed Intelligence:</b> 30m aur 60m explosive starts karein. Speed drills mein rest period lamba rakhein (Quality over Quantity). Plyometrics explosive power ke liye best hain.";
            }
            w.innerHTML += `<div class="msg msg-bot">${reply}</div>`;
            w.scrollTop = w.scrollHeight;
        }, 800);
    }

    function genMonthlyReport() { const o = document.getElementById('report-output'); o.style.display='block'; o.innerHTML = "<b>Monthly Audit:</b> Trends show 5% improvement in sprint velocity. Jumps are stable. Focus on leg strength next week!"; }

    // GLOBAL REVIEW LOGIC
    function submitReview() {
        const n = document.getElementById('revName').value.trim();
        const r = document.getElementById('revRole').value;
        const s = document.getElementById('revStars').value;
        const m = document.getElementById('revText').value.trim();
        if(n && m) {
            db.ref(`GLOBAL_REVIEWS`).push({ name: n, role: r, stars: parseInt(s), message: m, ts: Date.now() });
            document.getElementById('revText').value = '';
        }
    }

    db.ref(`GLOBAL_REVIEWS`).on('value', snap => {
        const wall = document.getElementById('reviewWall'); document.getElementById('revCount').innerText = snap.numChildren();
        wall.innerHTML = ''; let revs = []; snap.forEach(c => revs.push(c.val())); revs.reverse().forEach(d => {
            wall.innerHTML += `<div class="card" style="border-left:5px solid var(--ai-purple)"><b>${d.name}</b> <small>(${d.role})</small> ${'‚≠ê'.repeat(d.stars)}<p style="font-size:12px; margin-top:5px;">${d.message}</p></div>`;
        });
    });
</script>
</body>
</html>
