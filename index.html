<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Athlete Academy Pro AI - v61 Final Master</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #2563eb; --practice: #059669; --main: #dc2626; --bg: #f8fafc; --premium: #7c3aed; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-top: 65px; }
        .nav { position: fixed; top: 0; width: 100%; background: #fff; display: flex; border-bottom: 1px solid #e2e8f0; z-index: 1000; height: 60px; overflow-x: auto; scrollbar-width: none; }
        .nav-btn { min-width: 100px; flex: 1; padding: 20px 5px; text-align: center; font-size: 11px; font-weight: bold; color: #64748b; cursor: pointer; border: none; background: none; }
        .nav-btn.active { color: var(--primary); border-bottom: 3px solid var(--primary); background: #f0f7ff; }
        .container { padding: 15px; display: none; max-width: 600px; margin: auto; }
        .container.active { display: block; }
        .card { background: white; padding: 15px; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #e2e8f0; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 16px; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; color: white; cursor: pointer; font-size: 16px; margin-top: 10px; }
        .ai-coach-box { background: #f0fdf4; border-left: 5px solid #22c55e; padding: 12px; margin-top: 10px; border-radius: 8px; font-size: 13px; color: #166534; line-height: 1.4; }
        .profile-pic { width: 70px; height: 70px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary); display: block; margin: 0 auto 10px; }
        .data-list { margin-top: 10px; font-size: 11px; background: #f1f5f9; padding: 8px; border-radius: 10px; }
        .data-item { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid #ddd; }
        .del-btn { color: #dc2626; background: none; border: 1px solid #dc2626; border-radius: 4px; padding: 2px 5px; cursor: pointer; font-size: 9px; }
    </style>
</head>
<body>

    <div class="nav">
        <div class="nav-btn active" onclick="showTab('p-page', this)">PRACTICE</div>
        <div class="nav-btn" onclick="showTab('m-page', this)">MAIN</div>
        <div class="nav-btn" onclick="showTab('d-page', this)">DASHBOARD</div>
        <div class="nav-btn" onclick="showTab('a-page', this)">AI PREMIUM</div>
        <div class="nav-btn" onclick="showTab('v-page', this)">REVIEWS</div>
    </div>

    <div id="login-screen" style="padding: 20px; text-align: center; margin-top: 40px;">
        <div class="card">
            <h2>üèÜ Athlete Academy</h2>
            <input type="text" id="userAccessName" placeholder="Full Name">
            <input type="text" id="userPhotoUrl" placeholder="Profile Photo URL (Link)">
            <button class="btn" style="background: var(--primary)" onclick="setAthlete()">LOGIN</button>
        </div>
    </div>

    <div id="app-content" style="display: none;">
        <div id="p-page" class="container active">
            <h2>üèÉ Practice Drills</h2>
            <div class="card">
                <select id="pDrill">
                    <option>30 Metre</option><option>40 Metre</option><option>80 Metre</option><option>120 Metre</option>
                    <option>150 Metre</option><option>180 Metre</option><option>300 Metre</option><option>800 Metre</option>
                    <option>Broad Jump</option><option>Standing Triple</option><option>5 Bounded</option><option>10 Bounded</option>
                </select>
                <input type="number" step="0.01" id="pScore" placeholder="Result"><input type="date" id="pDate">
                <button class="btn" style="background: var(--practice)" onclick="saveData('Practice')">SAVE DATA</button>
            </div>
            <div id="practice-live-view"></div>
        </div>

        <div id="m-page" class="container">
            <h2>üèÜ Main Trials</h2>
            <div class="card">
                <select id="mEvent">
                    <option>100 Metre</option><option>200 Metre</option><option>400 Metre</option><option>800 Metre</option>
                    <option>1500 Metre</option><option>3 Kilometre</option><option>5 Kilometre</option>
                    <option>Long Jump</option><option>High Jump</option><option>Triple Jump</option>
                    <option>Javelin</option><option>Discus</option><option>Shot Put</option>
                </select>
                <input type="number" step="0.01" id="mScore" placeholder="Result"><input type="date" id="mDate">
                <button class="btn" style="background: var(--main)" onclick="saveData('Main')">SAVE RESULT</button>
            </div>
            <div id="main-live-view"></div>
        </div>

        <div id="d-page" class="container">
            <div id="athleteHeader" style="text-align:center"></div>
            <h2>üìä Performance Summary</h2>
            <div id="displayArea"></div>
        </div>

        <div id="a-page" class="container">
            <h2>ü§ñ AIA Premium Coach</h2>
            <div id="lock-screen" class="card" style="text-align: center;">
                <p>Unlock AI Coaching & Monthly PDF Reports.</p>
                <button class="btn" style="background:var(--premium)" onclick="payNow()">ACTIVATE SUBSCRIPTION</button>
                <hr><input type="text" id="actCode" placeholder="Code (1234)"><button class="btn" onclick="unlock()">ENTER CODE</button>
            </div>
            <div id="ai-content" style="display:none;">
                <div class="card" style="background: #f5f3ff; border: 1px solid #7c3aed;">
                    <h3>üìÖ Monthly Analysis</h3>
                    <p id="monthlyAnalysis">Scanning your progress... Please wait.</p>
                </div>
                <div class="card">
                    <div id="chatWall" style="height:200px; overflow-y:auto; background:#f8fafc; padding:10px; border-radius:10px; margin-bottom:10px;"></div>
                    <div style="display:flex; gap:5px;">
                        <input type="text" id="chatInput" placeholder="Ask anything..."><button class="btn" style="width:70px; margin:0;" onclick="askAI()">ASK</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="v-page" class="container">
            <h2>üí¨ Academy Reviews</h2>
            <div class="card">
                <input type="text" id="revName" placeholder="Name">
                <select id="revStars"><option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option><option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option></select>
                <textarea id="revText" placeholder="Share your experience..."></textarea>
                <button class="btn" style="background: var(--primary)" onclick="submitReview()">POST REVIEW</button>
            </div>
            <div id="globalReviewWall"></div>
        </div>
    </div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyBXlSIIG2czsrKYMJ07H7ibhXqd7jpOQR0", databaseURL: "https://athletetracker-5efd6-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const ID = 'user_v61_master_final';
    let currentAthlete = "";

    function setAthlete() {
        const n = document.getElementById('userAccessName').value.trim();
        const p = document.getElementById('userPhotoUrl').value.trim() || "https://cdn-icons-png.flaticon.com/512/3135/3135715.png";
        if(n) { currentAthlete = n; db.ref(`${ID}/data/${n}`).update({ photo: p }); document.getElementById('login-screen').style.display='none'; document.getElementById('app-content').style.display='block'; startApp(); }
    }

    function showTab(id, btn) {
        document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active'); btn.classList.add('active');
        if(id==='a-page' && localStorage.getItem('premium_v61')==='true') { 
            document.getElementById('lock-screen').style.display='none'; 
            document.getElementById('ai-content').style.display='block';
            runMonthlyAI();
        }
    }

    function startApp() {
        db.ref(`${ID}/data/${currentAthlete}`).on('value', snap => {
            const pV = document.getElementById('practice-live-view'); const dash = document.getElementById('displayArea');
            const data = snap.val(); pV.innerHTML = ''; dash.innerHTML = ''; if(!data) return;
            document.getElementById('athleteHeader').innerHTML = `<img src="${data.photo}" class="profile-pic"><br><b>${currentAthlete}</b>`;
            
            for(let cat in data) { if(cat==='photo') continue;
                for(let e in data[cat]) {
                    const logs = Object.entries(data[cat][e]).map(([k,v])=>({k,...v})).sort((a,b)=>a.ts-b.ts);
                    const gid = `g-${cat}-${e}`.replace(/\s/g,'');
                    const gc = document.createElement('div'); gc.className = 'card';
                    
                    let advice = "Add 2 entries for AI Coaching.";
                    let dietAdvice = "Diet: High Protein + Complex Carbs.";
                    if(logs.length > 1) {
                        const d = logs[logs.length-1].score - logs[logs.length-2].score;
                        advice = d < 0 ? "üöÄ <b>Improving!</b> Pichle session se better timing hai." : "‚ö†Ô∏è <b>Warning:</b> Performance thodi down hai, recovery ki zaroorat hai.";
                        dietAdvice = d < 0 ? "Workout: Stick to current plan. Diet: Add Creatine & Eggs." : "Workout: Focus on technique, light session today. Diet: Increase Hydration & Vitamin C.";
                    }

                    let listHtml = `<div class="data-list">`;
                    logs.forEach(l => { listHtml += `<div class="data-item"><span>${l.date}: <b>${l.score}</b></span> <button class="del-btn" onclick="deleteData('${cat}','${e}','${l.k}')">Del</button></div>`; });
                    listHtml += `</div>`;

                    gc.innerHTML = `<b>${e} Graph</b><canvas id="${gid}"></canvas><div class="ai-coach-box"><b>AI Coach:</b> ${advice}<br><br>${dietAdvice}</div>${listHtml}`;
                    if(cat==='Practice') pV.appendChild(gc); else dash.appendChild(gc);
                    setTimeout(() => new Chart(document.getElementById(gid), { type: 'line', data: { labels: logs.map(l=>l.date), datasets: [{ data: logs.map(l=>l.score), borderColor: '#2563eb', fill: false }] } }), 500);
                }
            }
        });
        db.ref(`${ID}/global_reviews`).on('value', snap => {
            const wall = document.getElementById('globalReviewWall'); wall.innerHTML = '';
            snap.forEach(c => { const d = c.val(); wall.innerHTML = `<div class="card"><b>${d.name}</b> ‚≠ê${d.stars}<p>${d.msg}</p></div>` + wall.innerHTML; });
        });
    }

    function deleteData(cat, ev, key) { if(confirm("Delete this specific result?")) db.ref(`${ID}/data/${currentAthlete}/${cat}/${ev.replace(/\s/g,'')}/${key}`).remove(); }
    function saveData(type) {
        const p = type === 'Practice' ? 'p' : 'm';
        const ev = document.getElementById(p+(type==='Practice'?'Drill':'Event')).value;
        const sc = parseFloat(document.getElementById(p+'Score').value);
        const dt = document.getElementById(p+'Date').value;
        if(sc && dt) db.ref(`${ID}/data/${currentAthlete}/${type}/${ev.replace(/\s/g,'')}`).push({ score: sc, date: dt, ts: Date.now() });
    }
    function submitReview() { db.ref(`${ID}/global_reviews`).push({ name: document.getElementById('revName').value, stars: document.getElementById('revStars').value, msg: document.getElementById('revText').value }); }
    function unlock() { if(document.getElementById('actCode').value === "1234") { localStorage.setItem('premium_v61', 'true'); location.reload(); }}
    function runMonthlyAI() { document.getElementById('monthlyAnalysis').innerHTML = `Hi ${currentAthlete}, is mahine aapne 8% improvement dikhayi hai. Aapka Javelin aur 100m ka trend upar ja raha hai. Next Month Goal: Power Clean and Squats increase kijiye.`; }
    function askAI() { 
        const i = document.getElementById('chatInput'); const w = document.getElementById('chatWall');
        if(i.value) { w.innerHTML += `<div style="text-align:right; color:blue;">Me: ${i.value}</div>`; 
        setTimeout(()=> { w.innerHTML += `<div style="color:green;">Coach: Focused raho, consistency hi sab kuch hai. Aaj recovery par dhyan do.</div>`; w.scrollTop = w.scrollHeight; }, 600); i.value=''; }
    }
</script>
</body>
</html>
