<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recovery Pro - Ultimate Athlete Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #1e40af; --practice: #059669; --main: #dc2626; --bg: #f1f5f9; --ai-purple: #7c3aed; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; padding-top: 65px; overflow-x: hidden; }
        
        .nav { position: fixed; top: 0; width: 100%; background: #fff; display: flex; box-shadow: 0 2px 8px rgba(0,0,0,0.1); z-index: 1000; height: 60px; overflow-x: auto; scrollbar-width: none; }
        .nav-btn { min-width: 85px; flex: 1; padding: 20px 5px; text-align: center; font-size: 10px; font-weight: bold; color: #64748b; cursor: pointer; border: none; background: none; text-transform: uppercase; }
        .nav-btn.active { color: var(--primary); border-bottom: 4px solid var(--primary); background: #f0f7ff; }

        .container { padding: 15px; display: none; max-width: 850px; margin: auto; }
        .container.active { display: block; }

        .card { background: white; padding: 20px; border-radius: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 25px; border: 1px solid #e2e8f0; position: relative; }
        .athlete-flashcard { background: white; border-radius: 20px; padding: 20px; border-left: 8px solid var(--ai-purple); cursor: pointer; transition: 0.3s; margin-bottom: 15px; }
        
        .event-scroller { display: flex; overflow-x: auto; gap: 15px; padding: 5px; scrollbar-width: none; }
        .event-box { min-width: 310px; background: #fff; border: 1px solid #f1f5f9; border-radius: 20px; padding: 15px; flex-shrink: 0; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
        
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 16px; background: #f8fafc; box-sizing: border-box; }
        .btn-save { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; color: white; cursor: pointer; font-size: 16px; margin-top: 10px; }
        
        .data-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 12px; }
        .data-table th, .data-table td { text-align: left; padding: 8px; border-bottom: 1px solid #f1f5f9; }
        .del-btn { color: #ef4444; border: none; background: none; cursor: pointer; font-weight: bold; font-size: 10px; }
        
        canvas { max-height: 180px; width: 100% !important; margin: 10px 0; }
        .live-count-badge { background: var(--ai-purple); color: white; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; }

        .star-rating { font-size: 24px; color: #cbd5e1; cursor: pointer; margin: 10px 0; display: flex; gap: 5px; }
        .star.selected { color: #fbbf24; }

        .ai-box { background: #f5f3ff; border-left: 4px solid var(--ai-purple); padding: 12px; border-radius: 12px; margin-top: 10px; font-size: 12px; color: #4c1d95; line-height: 1.4; }
        .ai-box b { color: var(--ai-purple); display: block; margin-bottom: 3px; }
    </style>
</head>
<body>

    <div class="nav">
        <div class="nav-btn active" onclick="showTab('p-page', this)">PRACTICE</div>
        <div class="nav-btn" onclick="showTab('m-page', this)">OFFICIAL</div>
        <div class="nav-btn" onclick="showTab('d-page', this)">ANALYTICS</div>
        <div class="nav-btn" onclick="showTab('v-page', this)">REVIEWS</div>
    </div>

    <div id="p-page" class="container active">
        <div class="card">
            <h3>üèÉ Practice Log</h3>
            <input type="text" id="pName" placeholder="Athlete Name">
            <select id="pDrill">
               <option>30m</option><option>40m</option><option>60m</option><option>80m</option>
                    <option>120m</option><option>150m</option><option>180m</option><option>300m</option>
                </optgroup>
                <optgroup label="Jumps (Distance)">
                    <option>Board Jump</option><option>Triple Jump</option><option>Standing Triple</option>
                    <option>5 Bounded</option><option>10 Bounded</option>
                </optgroup>
                <optgroup label="Throws">
                    <option>Ball Throw</option><option>Back Throw</option>
                </optgroup>
                
            </select>
            <input type="number" step="0.01" id="pScore" placeholder="Result">
            <input type="date" id="pDate">
            <button class="btn-save" style="background: var(--practice)" onclick="saveData('Practice')">SAVE PRACTICE</button>
        </div>
        <div id="practice-display"></div>
    </div>

    <div id="m-page" class="container">
        <div class="card">
            <h3>üèÜ Official Trial</h3>
            <input type="text" id="mName" placeholder="Athlete Name">
            <select id="mEvent">
              <optgroup label="Track Events (Running)">
                    <option value="100m">100 Metre</option>
                    <option value="200m">200 Metre</option>
                    <option value="400m">400 Metre</option>
                    <option value="800m">800 Metre</option>
                    <option value="1500m">1500 Metre</option>
                    <option value="3000m">3000 Metre</option>
                    <option value="5000m">5000 Metre</option>
                </optgroup>
                <optgroup label="Jumping Events">
                    <option value="long-jump">Long Jump</option>
                    <option value="high-jump">High Jump</option>
                    <option value="triple-jump">Triple Jump</option>
                </optgroup>
                <optgroup label="Throwing Events">
                    <option value="javelin-throw">Javelin Throw</option>
                    <option value="shot-put">Shot Put</option>
                    <option value="Discus-throw">Discus throw</option>
                    
                </optgroup>
                
            <input type="number" step="0.01" id="mScore" placeholder="Result">
            <input type="date" id="mDate">
            <button class="btn-save" style="background: var(--main)" onclick="saveData('Main')">SAVE OFFICIAL</button>
        </div>
        <div id="main-display"></div>
    </div>

    <div id="d-page" class="container">
        <h2 style="text-align:center">üìà Progress Dashboard</h2>
        <div id="flashcard-list"></div>
        <div id="detail-view" style="display:none;">
            <button class="btn-save" style="background:#64748b; margin-bottom:10px;" onclick="closeDetails()">‚Üê BACK</button>
            <div id="detail-content"></div>
        </div>
    </div>

    <div id="v-page" class="container">
        <div style="text-align:center; margin-bottom:15px;">
            <span class="live-count-badge">GLOBAL COMMUNITY REVIEWS: <span id="revCount">0</span></span>
        </div>
        <div class="card">
            <h3>üí¨ Global Experience Review</h3>
            <div class="star-rating" id="starContainer">
                <span class="star" onclick="setStar(1)">‚òÖ</span><span class="star" onclick="setStar(2)">‚òÖ</span><span class="star" onclick="setStar(3)">‚òÖ</span><span class="star" onclick="setStar(4)">‚òÖ</span><span class="star" onclick="setStar(5)">‚òÖ</span>
            </div>
            <input type="text" id="revName" placeholder="Your Name">
            <textarea id="revText" placeholder="Write feedback..."></textarea>
            <button class="btn-save" style="background: var(--ai-purple)" onclick="submitReview()">POST GLOBAL REVIEW</button>
        </div>
        <div id="reviewWall"></div>
    </div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyBXlSIIG2czsrKYMJ07H7ibhXqd7jpOQR0", databaseURL: "https://athletetracker-5efd6-default-rtdb.firebaseio.com" };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let devID = localStorage.getItem('athlete_dev_id') || 'D-' + Math.random().toString(36).substr(2, 9);
    localStorage.setItem('athlete_dev_id', devID);
    const ID = 'Elite_' + devID;

    let selectedStars = 0;
    function setStar(n) {
        selectedStars = n;
        document.querySelectorAll('.star').forEach((s, i) => s.classList.toggle('selected', i < n));
    }

    function showTab(id, btn) {
        document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
    }

    function getAISuggestion(ev, logs) {
        if(logs.length < 2) return "Naya data add karein AI analysis ke liye.";
        let l = parseFloat(logs[logs.length-1].score), p = parseFloat(logs[logs.length-2].score);
        let name = ev.toLowerCase();
        let status = (name.includes('m') || name.includes('sprint')) ? (l < p ? "Improvement!" : "Keep Working!") : (l > p ? "Improvement!" : "Keep Working!");
        if(name.includes('m')) return `<b>ü§ñ AI Coach: ${status}</b> Workout: Wall drills karein. Diet: Complex carbs lein.`;
        if(name.includes('jump')) return `<b>ü§ñ AI Coach: ${status}</b> Workout: Plyometrics karein. Diet: Protein badhayein.`;
        return "Consistency banaye rakhein.";
    }

    function saveData(type) {
        const pre = type === 'Practice' ? 'p' : 'm';
        const n = document.getElementById(pre+'Name').value.trim(), e = document.getElementById(pre+(type==='Practice'?'Drill':'Event')).value, s = document.getElementById(pre+'Score').value, d = document.getElementById(pre+'Date').value;
        if(n && s && d) { db.ref(`${ID}/data/${n}/${type}/${e.replace(/\s/g,'-')}`).push({ score: s, date: d }); document.getElementById(pre+'Score').value = ''; }
    }

    function deleteRecord(n, c, e, rid) { if(confirm("Delete?")) db.ref(`${ID}/data/${n}/${c}/${e}/${rid}`).remove(); }

    db.ref(`${ID}/data`).on('value', snap => {
        const data = snap.val();
        renderTabDisplay('Practice', 'practice-display', data);
        renderTabDisplay('Main', 'main-display', data);
        renderFlashcards(data);
    });

    function renderTabDisplay(cat, divId, data) {
        const target = document.getElementById(divId); target.innerHTML = '';
        if(!data) return;
        for(let n in data) if(data[n][cat]) {
            const card = document.createElement('div'); card.className = 'card';
            card.innerHTML = `<h4>üë§ ${n}</h4><div class="event-scroller" id="scr-${divId}-${n}"></div>`;
            target.appendChild(card);
            for(let ev in data[n][cat]) {
                const logs = Object.entries(data[n][cat][ev]).map(([id,v])=>({id,...v})).sort((a,b)=>new Date(a.date)-new Date(b.date));
                const gid = `ch-${divId}-${n}-${ev}`.replace(/\s+/g,'-');
                const box = document.createElement('div'); box.className = 'event-box';
                box.innerHTML = `<strong>${ev}</strong><canvas id="${gid}"></canvas><div class="ai-box">${getAISuggestion(ev, logs)}</div><table class="data-table"><tbody>${logs.map(l=>`<tr><td>${l.date}</td><td>${l.score}</td><td><button class="del-btn" onclick="deleteRecord('${n}','${cat}','${ev}','${l.id}')">X</button></td></tr>`).join('')}</tbody></table>`;
                card.querySelector('.event-scroller').appendChild(box);
                setTimeout(() => initChart(gid, logs, cat, ev), 100);
            }
        }
    }

    function renderFlashcards(data) {
        const list = document.getElementById('flashcard-list'); list.innerHTML = ''; if(!data) return;
        for(let n in data) {
            const f = document.createElement('div'); f.className = 'athlete-flashcard';
            f.innerHTML = `<h3>üë§ ${n}</h3><p>Tap to view Official & Practice Analytics</p>`;
            f.onclick = () => openDetails(n, data[n]); list.appendChild(f);
        }
    }

    function initChart(id, logs, cat, evName) {
        const ctx = document.getElementById(id); if(!ctx) return;
        new Chart(ctx, { type: 'line', data: { labels: logs.map(l=>l.date), datasets: [{ data: logs.map(l=>parseFloat(l.score)), borderColor: cat==='Practice'?'#059669':'#dc2626', tension: 0.4 }] }, options: { plugins: { legend: { display: false } }, scales: { y: { reverse: evName.toLowerCase().includes('m') } } } });
    }

    function openDetails(n, athleteData) {
        document.getElementById('flashcard-list').style.display = 'none';
        const dv = document.getElementById('detail-view'), content = document.getElementById('detail-content');
        dv.style.display = 'block'; content.innerHTML = `<h3 style="text-align:center">${n}'s Hub</h3>`;
        for(let cat in athleteData) {
            const scroller = document.createElement('div'); scroller.className = 'event-scroller';
            for(let ev in athleteData[cat]) {
                const logs = Object.entries(athleteData[cat][ev]).map(([id,v])=>({id,...v})).sort((a,b)=>new Date(a.date)-new Date(b.date));
                const gid = `det-${n}-${cat}-${ev}`.replace(/\s+/g,'-');
                const box = document.createElement('div'); box.className = 'event-box';
                box.innerHTML = `<strong>${cat}: ${ev}</strong><canvas id="${gid}"></canvas><div class="ai-box">${getAISuggestion(ev, logs)}</div><table class="data-table"><tbody>${logs.map(l=>`<tr><td>${l.date}</td><td>${l.score}</td><td><button class="del-btn" onclick="deleteRecord('${n}','${cat}','${ev}','${l.id}')">X</button></td></tr>`).join('')}</tbody></table>`;
                scroller.appendChild(box); setTimeout(() => initChart(gid, logs, cat, ev), 100);
            }
            content.appendChild(scroller);
        }
    }

    function closeDetails() { document.getElementById('flashcard-list').style.display = 'block'; document.getElementById('detail-view').style.display = 'none'; }

    // GLOBAL REVIEWS (FIXED LISTENER)
    function submitReview() {
        const n = document.getElementById('revName').value.trim(), m = document.getElementById('revText').value.trim();
        if(n && m && selectedStars > 0) {
            db.ref(`GLOBAL_REVIEWS`).push({ name: n, stars: selectedStars, message: m, ts: Date.now() }).then(() => {
                document.getElementById('revText').value = ''; setStar(0);
            });
        }
    }

    db.ref(`GLOBAL_REVIEWS`).on('value', snap => {
        const wall = document.getElementById('reviewWall');
        document.getElementById('revCount').innerText = snap.numChildren();
        wall.innerHTML = '';
        const reviews = [];
        snap.forEach(c => { reviews.push(c.val()); });
        reviews.sort((a, b) => b.ts - a.ts).forEach(d => {
            const div = document.createElement('div'); div.className = 'card';
            div.style.borderLeft = "5px solid var(--ai-purple)";
            div.innerHTML = `<b>${d.name}</b> <span style="color:#fbbf24">${'‚òÖ'.repeat(d.stars)}</span><p style="font-size:13px; margin-top:5px;">${d.message}</p>`;
            wall.appendChild(div);
        });
    });
</script>
</body>
</html>

