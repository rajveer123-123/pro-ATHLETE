<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Athlete Elite Pro - Professional Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #2563eb; --practice: #059669; --main: #dc2626; --bg: #f1f5f9; --ai-gold: #7c3aed; --white: #ffffff; }
        body { font-family: 'Inter', 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-top: 65px; color: #1e293b; }
        
        /* Navigation */
        .nav { position: fixed; top: 0; width: 100%; background: #fff; display: flex; border-bottom: 1px solid #e2e8f0; z-index: 1000; height: 60px; overflow-x: auto; scrollbar-width: none; }
        .nav-btn { min-width: 90px; flex: 1; padding: 18px 5px; text-align: center; font-size: 11px; font-weight: bold; color: #64748b; cursor: pointer; border: none; background: none; text-transform: uppercase; letter-spacing: 0.5px; }
        .nav-btn.active { color: var(--primary); border-bottom: 3px solid var(--primary); background: #f8faff; }

        .container { padding: 15px; display: none; max-width: 800px; margin: auto; animation: fadeIn 0.3s ease; }
        .container.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Professional Cards */
        .card { background: var(--white); padding: 20px; border-radius: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.04); margin-bottom: 25px; border: 1px solid #edf2f7; position: relative; }
        input, select, textarea { width: 100%; padding: 14px; margin: 8px 0; border: 1px solid #e2e8f0; border-radius: 14px; font-size: 16px; background: #f8fafc; }
        .btn { width: 100%; padding: 16px; border: none; border-radius: 14px; font-weight: bold; color: white; cursor: pointer; font-size: 16px; margin-top: 10px; transition: 0.3s; }
        .btn:active { transform: scale(0.98); }

        /* Dashboard Specifics */
        .scroll-x { display: flex; overflow-x: auto; gap: 12px; padding: 10px 0; scrollbar-width: none; }
        .graph-card { min-width: 320px; background: #fff; border: 1px solid #f1f5f9; border-radius: 24px; padding: 20px; margin-right: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
        .ath-chip { padding: 10px 20px; background: #fff; border: 1px solid #e2e8f0; border-radius: 30px; font-size: 13px; cursor: pointer; white-space: nowrap; font-weight: 600; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .ath-chip.selected { background: var(--primary); color: white; border-color: var(--primary); }
        
        /* Analytics Badges */
        .ai-box { background: #f5f3ff; border-radius: 16px; padding: 15px; margin-top: 15px; border: 1px solid #e9d5ff; font-size: 13px; }
        .pb-badge { background: linear-gradient(135deg, #fffbeb, #fef3c7); border: 1px solid #fbbf24; padding: 6px 14px; border-radius: 12px; font-size: 12px; font-weight: 800; color: #92400e; display: inline-flex; align-items: center; gap: 5px; }
        
        .stat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; }
        .stat-item { background: #f8fafc; padding: 12px; border-radius: 14px; border: 1px solid #f1f5f9; }
        .stat-val { font-size: 18px; font-weight: 800; color: var(--primary); }
        .stat-lbl { font-size: 10px; color: #64748b; text-transform: uppercase; }

        .del-athlete { background: #fee2e2; color: #dc2626; border: none; padding: 6px 12px; border-radius: 10px; font-size: 11px; font-weight: bold; cursor: pointer; position: absolute; top: 20px; right: 20px; }
        canvas { max-height: 240px; margin: 15px 0; }
    </style>
</head>
<body>

    <div class="nav">
        <div class="nav-btn active" onclick="showTab('p-page', this)">PRACTICE</div>
        <div class="nav-btn" onclick="showTab('m-page', this)">OFFICIAL</div>
        <div class="nav-btn" onclick="showTab('d-page', this)">ANALYTICS</div>
        <div class="nav-btn" onclick="showTab('a-page', this)">AI COACH</div>
        <div class="nav-btn" onclick="showTab('v-page', this)">REVIEWS</div>
    </div>

    <div id="p-page" class="container active">
        <div class="card">
            <h2>üèÉ Practice Sessions</h2>
            <input type="text" id="pName" placeholder="Athlete Name">
            <select id="pDrill">
                <option>30m Sprint</option><option>60m Sprint</option><option>150m Pace</option><option>300m Pace</option><option>Broad Jump</option><option>Box Jumps</option>
            </select>
            <input type="number" step="0.01" id="pScore" placeholder="Result (s or m)">
            <input type="date" id="pDate">
            <button class="btn" style="background: var(--practice)" onclick="saveData('Practice')">ADD RECORD</button>
        </div>
        <div id="practice-live-view"></div>
    </div>

    <div id="m-page" class="container">
        <div class="card">
            <h2>üèÜ Official Trials</h2>
            <input type="text" id="mName" placeholder="Athlete Name">
            <select id="mEvent">
                <option>100 Metre</option><option>200 Metre</option><option>400 Metre</option><option>800 Metre</option>
                <option>1500 Metre</option><option>Long Jump</option><option>High Jump</option><option>Shot Put</option>
            </select>
            <input type="number" step="0.01" id="mScore" placeholder="Result (s or m)">
            <input type="date" id="mDate">
            <button class="btn" style="background: var(--main)" onclick="saveData('Main')">SAVE TRIAL DATA</button>
        </div>
        <div id="main-live-view"></div>
    </div>

    <div id="d-page" class="container">
        <h2 style="text-align:center">üìä Performance Dashboard</h2>
        <div id="athFilter" class="scroll-x"></div>
        <div id="displayArea"></div>
    </div>

    <div id="a-page" class="container">
        <h2 style="color: var(--ai-gold); text-align: center;">ü§ñ AIA Premium Coaching</h2>
        <div id="lock-screen" class="card" style="text-align: center;">
            <h3>Premium Access Locked üîí</h3>
            <input type="text" id="actCode" placeholder="Enter Code (1234)">
            <button class="btn" style="background: var(--ai-gold)" onclick="unlockPremium()">UNLOCK AI COACHING</button>
        </div>
        <div id="ai-content" style="display:none;">
            <div class="card">
                <h4>üí¨ 24/7 AI Smart Coach</h4>
                <div id="chat-wall" style="height: 200px; overflow-y: auto; background: #f8fafc; padding: 12px; border-radius: 16px; margin-bottom: 12px; border: 1px solid #e2e8f0; font-size: 13px;"></div>
                <div style="display:flex; gap:8px;"><input type="text" id="chat-in" style="margin:0;"><button class="btn" style="width:70px; margin:0; background: var(--ai-gold)" onclick="askPremiumAI()">ASK</button></div>
            </div>
            <div class="card">
                <h4>üìë Monthly Performance Audit</h4>
                <button class="btn" style="background: var(--primary)" onclick="genFullReport()">GENERATE AUDIT REPORT</button>
                <div id="report-output" style="margin-top:15px;"></div>
            </div>
        </div>
    </div>

    <div id="v-page" class="container">
        <h2>üí¨ Global Feedback (<span id="revCount">0</span>)</h2>
        <div class="card">
            <input type="text" id="revName" placeholder="Name">
            <select id="revStars"><option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excellent</option><option value="4">‚≠ê‚≠ê‚≠ê‚≠ê Good</option><option value="3">‚≠ê‚≠ê‚≠ê Average</option></select>
            <textarea id="revText" placeholder="Share academy experience..."></textarea>
            <button class="btn" style="background: var(--ai-gold)" onclick="submitReview()">POST REVIEW LIVE</button>
        </div>
        <div id="reviewWall"></div>
    </div>

<script>
    // Firebase Config
    const firebaseConfig = { apiKey: "AIzaSyBXlSIIG2czsrKYMJ07H7ibhXqd7jpOQR0", databaseURL: "https://athletetracker-5efd6-default-rtdb.firebaseio.com" };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let devID = localStorage.getItem('athlete_dev_id') || 'D-' + Math.random().toString(36).substr(2, 9);
    localStorage.setItem('athlete_dev_id', devID);
    const ID = 'Elite_' + devID;
    let selectedAthlete = "All";
    let charts = {};

    function showTab(id, btn) {
        document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
        if(localStorage.getItem('p_active') === 'true') { 
            document.getElementById('lock-screen').style.display = 'none'; 
            document.getElementById('ai-content').style.display = 'block'; 
        }
    }

    function unlockPremium() { if(document.getElementById('actCode').value==='1234'){ localStorage.setItem('p_active','true'); location.reload(); } }

    function saveData(type) {
        const p = type === 'Practice' ? 'p' : 'm';
        const name = document.getElementById(p+'Name').value.trim();
        const event = document.getElementById(p+(type==='Practice'?'Drill':'Event')).value;
        const score = document.getElementById(p+'Score').value;
        const date = document.getElementById(p+'Date').value;
        if(name && score && date) {
            db.ref(`${ID}/data/${name}/${type}/${event.replace(/\s/g,'-')}`).push({ score, date, ts: Date.now(), event });
            alert("Entry Saved!");
        }
    }

    function deleteAthlete(n) { if(confirm("Permanently delete this profile?")) db.ref(`${ID}/data/${n}`).remove(); }
    function deleteEntry(n, c, e, k) { if(confirm("Remove this entry?")) db.ref(`${ID}/data/${n}/${c}/${e}/${k}`).remove(); }

    function askPremiumAI() {
        const i = document.getElementById('chat-in'); const w = document.getElementById('chat-wall');
        w.innerHTML += `<div style="text-align:right"><b>You:</b> ${i.value}</div>`; 
        setTimeout(() => { w.innerHTML += `<div style="color:var(--ai-gold)"><b>Coach AI:</b> Analyzed your query. Focus on explosive drills.</div>`; w.scrollTop = w.scrollHeight; }, 600);
        i.value = '';
    }

    function genFullReport() { document.getElementById('report-output').innerHTML = `<div class="ai-box"><b>Audit:</b> Speed +4%, Strength Optimized. Recommendation: Add plyometric drills.</div>`; }

    db.ref(`${ID}/data`).on('value', snap => {
        const pV = document.getElementById('practice-live-view'); const mV = document.getElementById('main-live-view'); 
        const dash = document.getElementById('displayArea'); const filter = document.getElementById('athFilter');
        pV.innerHTML = ''; mV.innerHTML = ''; dash.innerHTML = ''; 
        const data = snap.val(); if(!data) return;

        filter.innerHTML = `<div class="ath-chip ${selectedAthlete==='All'?'selected':''}" onclick="selectedAthlete='All'">Show All</div>`;
        Object.keys(data).forEach(a => { filter.innerHTML += `<div class="ath-chip ${selectedAthlete===a?'selected':''}" onclick="selectedAthlete='${a}'">${a}</div>`; });

        for(let n in data) {
            if(selectedAthlete !== "All" && selectedAthlete !== n) continue;
            const aCard = document.createElement('div'); aCard.className = 'card';
            aCard.innerHTML = `<button class="del-athlete" onclick="deleteAthlete('${n}')">DELETE</button><h3>üë§ ${n} A-Z Analysis</h3>`;
            
            for(let cat in data[n]) {
                const target = cat === 'Practice' ? pV : mV;
                const sec = document.createElement('div'); 
                sec.innerHTML = `<h4>üë§ ${n} - ${cat}</h4><div class="scroll-x" id="sc-${cat}-${n}"></div>`; 
                target.appendChild(sec);

                for(let evKey in data[n][cat]) {
                    const logs = Object.entries(data[n][cat][evKey]).map(([k, v]) => ({key: k, ...v})).sort((a,b)=>a.ts-b.ts);
                    const scores = logs.map(l => parseFloat(l.score));
                    const isDist = evKey.includes("Jump") || evKey.includes("Put") || evKey.includes("Throw") || evKey.includes("Bounded");
                    const pb = isDist ? Math.max(...scores) : Math.min(...scores);
                    const last = scores[scores.length-1];

                    const gId = `g-${cat}-${n}-${evKey}`.replace(/\s+/g,'-');
                    const gCard = document.createElement('div'); gCard.className = 'graph-card';
                    gCard.innerHTML = `<b>${evKey}</b> <br> <span class="pb-badge">‚≠ê PERSONAL BEST: ${pb}</span>
                        <canvas id="${gId}"></canvas>
                        <div class="stat-grid">
                            <div class="stat-item"><div class="stat-lbl">Latest</div><div class="stat-val">${last}</div></div>
                            <div class="stat-item"><div class="stat-lbl">Trend</div><div class="stat-val" style="color:${last==pb?'green':'orange'}">${last==pb?'New PB':'Stable'}</div></div>
                        </div>
                        <div class="ai-box"><b>ü§ñ AI COACH:</b><br>${isDist?'Focus on take-off velocity.':'Work on finishing 50m phase.'}</div>
                        <div style="margin-top:15px; border-top:1px solid #eee; padding-top:10px;">
                        ${logs.map(l => `<div style="display:flex; justify-content:space-between; font-size:11px; margin-bottom:5px;"><span>üìÖ ${l.date}: <b>${l.score}</b></span><button class="del-btn" style="background:none; color:red; border:none; cursor:pointer;" onclick="deleteEntry('${n}','${cat}','${evKey}','${l.key}')">Remove</button></div>`).join('')}</div>`;
                    
                    document.getElementById(`sc-${cat}-${n}`).appendChild(gCard);
                    setTimeout(() => {
                        if(charts[gId]) charts[gId].destroy();
                        charts[gId] = new Chart(document.getElementById(gId), { type: 'line', data: { labels: logs.map(l=>l.date), datasets: [{ data: logs.map(l=>l.score), borderColor: '#2563eb', tension:0.4, fill: true, backgroundColor:'rgba(37,99,235,0.05)' }] }, options: { plugins: { legend: { display: false } }, scales: { y: { reverse: !isDist } } } });
                    }, 500);
                }
            }
            dash.appendChild(aCard);
        }
    });

    function submitReview() { 
        const n = document.getElementById('revName').value; const s = document.getElementById('revStars').value; const m = document.getElementById('revText').value; 
        if(n && m) { db.ref(`GLOBAL_REVIEWS`).push({ name: n, rating: s, msg: m }); document.getElementById('revText').value=''; alert("Live Review Posted!"); }
    }
    db.ref(`GLOBAL_REVIEWS`).on('value', snap => {
        const wall = document.getElementById('reviewWall'); document.getElementById('revCount').innerText = snap.numChildren();
        wall.innerHTML = ''; snap.forEach(c => { const d = c.val(); wall.innerHTML = `<div class="card" style="border-left:5px solid var(--ai-gold)"><b>${d.name}</b> ${'‚≠ê'.repeat(d.rating)}<p style="font-size:13px;">${d.msg}</p></div>` + wall.innerHTML; });
    });
</script>
</body>
</html>
