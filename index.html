<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recovery Pro - AI Athlete System</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #2563eb; --practice: #10b981; --main: #ef4444; --bg: #f1f5f9; --ai: #8b5cf6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-top: 70px; }
        
        /* Navigation */
        .nav { position: fixed; top: 0; width: 100%; background: #fff; display: flex; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 1000; height: 60px; overflow-x: auto; }
        .nav-btn { min-width: 80px; flex: 1; border: none; background: none; font-size: 10px; font-weight: bold; color: #64748b; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .nav-btn.active { color: var(--primary); border-bottom: 4px solid var(--primary); background: #f0f7ff; }

        .container { padding: 15px; display: none; max-width: 800px; margin: auto; animation: fadeIn 0.3s; }
        .container.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 15px; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer; }

        /* AI Chat Box */
        #chat-window { height: 300px; overflow-y: auto; border: 1px solid #eee; padding: 10px; display: flex; flex-direction: column; gap: 10px; background: #fafafa; border-radius: 10px; }
        .msg { padding: 10px; border-radius: 10px; max-width: 80%; font-size: 14px; }
        .user-msg { align-self: flex-end; background: var(--primary); color: white; }
        .ai-msg { align-self: flex-start; background: var(--ai); color: white; }

        /* Data Analysis Flex */
        .analysis-grid { display: flex; flex-wrap: wrap; gap: 15px; }
        .event-card { flex: 1; min-width: 300px; background: white; border-radius: 15px; padding: 15px; border: 1px solid #eee; position: relative; }
        .del-x { position: absolute; top: 10px; right: 10px; background: #fee2e2; color: red; border: none; border-radius: 50%; cursor: pointer; font-weight: bold; width: 25px; height: 25px; }
        
        .live-tag { background: #000; color: #fbbf24; padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; text-align: center; margin-bottom: 10px; }
        canvas { width: 100% !important; height: 180px !important; }
    </style>
</head>
<body>

    <div class="nav">
        <div class="nav-btn active" onclick="showTab('p-page', this)"><span>üèÉ</span>PRACTICE</div>
        <div class="nav-btn" onclick="showTab('m-page', this)"><span>üèÜ</span>OFFICIAL</div>
        <div class="nav-btn" onclick="showTab('d-page', this)"><span>üìä</span>DATA</div>
        <div class="nav-btn" onclick="showTab('a-page', this)"><span>üß†</span>AI CHAT</div>
        <div class="nav-btn" onclick="showTab('v-page', this)"><span>‚≠ê</span>REVIEWS</div>
    </div>

    <div id="p-page" class="container active">
        <div class="card">
            <h3>üèÉ Add Practice Log</h3>
            <input type="text" id="pName" placeholder="Athlete Name">
            <select id="pDrill">
               <option>30m</option><option>40m</option><option>60m</option><option>80m</option>
                    <option>120m</option><option>150m</option><option>180m</option><option>300m</option>
                </optgroup>
                <optgroup label="Jumps (Distance)">
                    <option>Board Jump</option><option>Triple Jump</option><option>Standing Triple</option>
                    <option>5 Bounded</option><option>10 Bounded</option>
                </optgroup>
                <optgroup label="Throws">
                    <option>Ball Throw</option><option>Back Throw</option>
                </optgroup>
                
            <input type="number" step="0.01" id="pScore" placeholder="Score">
            <input type="date" id="pDate">
            <button class="btn" style="background: var(--practice)" onclick="saveData('Practice')">SAVE PRACTICE</button>
        </div>
        <div id="practice-charts" class="analysis-grid"></div>
    </div>

    <div id="m-page" class="container">
        <div class="card">
            <h3>üèÜ Add Official Trial</h3>
            <input type="text" id="mName" placeholder="Athlete Name">
            <select id="mEvent">
               <optgroup label="Track Events (Running)">
                    <option value="100m">100 Metre</option>
                    <option value="200m">200 Metre</option>
                    <option value="400m">400 Metre</option>
                    <option value="800m">800 Metre</option>
                    <option value="1500m">1500 Metre</option>
                    <option value="3000m">3000 Metre</option>
                    <option value="5000m">5000 Metre</option>
                </optgroup>
                <optgroup label="Jumping Events">
                    <option value="long-jump">Long Jump</option>
                    <option value="high-jump">High Jump</option>
                    <option value="triple-jump">Triple Jump</option>
                </optgroup>
                <optgroup label="Throwing Events">
                    <option value="javelin-throw">Javelin Throw</option>
                    <option value="shot-put">Shot Put</option>
                    <option value="Discus-throw">Discus throw</option>
                    
                </optgroup>
                
            </select>
            <input type="number" step="0.01" id="mScore" placeholder="Official Score">
            <input type="date" id="mDate">
            <button class="btn" style="background: var(--main)" onclick="saveData('Main')">SAVE OFFICIAL</button>
        </div>
        <div id="main-charts" class="analysis-grid"></div>
    </div>

    <div id="a-page" class="container">
        <div class="card">
            <h3>üß† AIA Interactive Coach</h3>
            <div id="chat-window">
                <div class="msg ai-msg">Hello! Main aapka AI Coach hoon. Training ya recovery ke baare mein kuch bhi puchiye.</div>
            </div>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <input type="text" id="chatInput" placeholder="Puchiye: 'Sprints kaise sudharein?'">
                <button onclick="askAI()" style="background:var(--ai); color:white; border:none; border-radius:10px; padding:0 20px; cursor:pointer;">SEND</button>
            </div>
        </div>
    </div>

    <div id="d-page" class="container">
        <div class="live-tag">üìä FULL FLEX PERFORMANCE DASHBOARD</div>
        <div id="flex-analysis" class="analysis-grid"></div>
    </div>

    <div id="v-page" class="container">
        <div class="live-tag">üåç GLOBAL FEEDBACK COUNTER: <span id="revCount">0</span></div>
        <div class="card">
            <h3>‚≠ê Rate & Review</h3>
            <input type="text" id="revName" placeholder="Name">
            <select id="revRole"><option>Athlete</option><option>Coach</option><option>Student</option></select>
            <textarea id="revText" placeholder="Share your experience..."></textarea>
            <button class="btn" style="background: var(--ai)" onclick="submitReview()">POST GLOBALLY</button>
        </div>
        <div id="reviewWall"></div>
    </div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyBXlSIIG2czsrKYMJ07H7ibhXqd7jpOQR0", databaseURL: "https://athletetracker-5efd6-default-rtdb.firebaseio.com" };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const ID = 'Elite_AI_' + (localStorage.getItem('athlete_dev_id') || Math.random().toString(36).substr(2, 6));
    localStorage.setItem('athlete_dev_id', ID);

    let charts = {};

    function showTab(t, b) {
        document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(n => n.classList.remove('active'));
        document.getElementById(t).classList.add('active');
        b.classList.add('active');
    }

    // Data Management
    function saveData(type) {
        const p = type === 'Practice' ? 'p' : 'm';
        const n = document.getElementById(p+'Name').value;
        const e = document.getElementById(p+(type==='Practice'?'Drill':'Event')).value;
        const s = document.getElementById(p+'Score').value;
        const d = document.getElementById(p+'Date').value;
        if(n && s && d) {
            db.ref(`${ID}/data/${n}/${type}/${e.replace(/\s/g,'-')}`).push({ score: parseFloat(s), date: d });
            alert("Saved!");
        }
    }

    function deleteEntry(n, t, e, k) {
        if(confirm("Delete this record?")) db.ref(`${ID}/data/${n}/${t}/${e}/${k}`).remove();
    }

    // AI Chat Logic
    function askAI() {
        const inp = document.getElementById('chatInput');
        const win = document.getElementById('chat-window');
        if(!inp.value) return;

        win.innerHTML += `<div class="msg user-msg">${inp.value}</div>`;
        const q = inp.value.toLowerCase();
        let reply = "Mujhe is baare mein abhi aur seekhna hai, par aap practice jari rakhein!";
        
        if(q.includes("sprint")) reply = "Sprint speed badhane ke liye 'Knee Drive' aur 'High Frequency' drills karein.";
        if(q.includes("pain")) reply = "Agar dard hai toh 'RICE' technique use karein aur doctor se milein.";
        if(q.includes("diet")) reply = "Protein rich foods (eggs, paneer, soy) recovery ke liye best hain.";
        
        setTimeout(() => {
            win.innerHTML += `<div class="msg ai-msg">ü§ñ: ${reply}</div>`;
            win.scrollTop = win.scrollHeight;
        }, 800);
        inp.value = '';
    }

    // Real-time Dashboard with Flex Analysis
    db.ref(`${ID}/data`).on('value', snap => {
        const data = snap.val();
        const flexBox = document.getElementById('flex-analysis');
        const practiceBox = document.getElementById('practice-charts');
        const mainBox = document.getElementById('main-charts');
        
        [flexBox, practiceBox, mainBox].forEach(b => b.innerHTML = '');
        if(!data) return;

        for(let athlete in data) {
            for(let type in data[athlete]) {
                for(let event in data[athlete][type]) {
                    const logs = Object.entries(data[athlete][type][event]).map(([k,v])=>({k,...v}));
                    const gid = `ch-${athlete}-${type}-${event}`.replace(/\s/g,'');
                    
                    const card = document.createElement('div');
                    card.className = 'event-card';
                    card.innerHTML = `<h4>üë§ ${athlete} - ${event} (${type})</h4><canvas id="${gid}"></canvas>`;
                    
                    logs.forEach(l => {
                        card.innerHTML += `<div style="font-size:11px; margin-top:5px;">üìÖ ${l.date}: <b>${l.score}</b> <button class="del-x" onclick="deleteEntry('${athlete}','${type}','${event}','${l.k}')">X</button></div>`;
                    });

                    if(type === 'Practice') practiceBox.appendChild(card.cloneNode(true));
                    else mainBox.appendChild(card.cloneNode(true));
                    flexBox.appendChild(card);

                    setTimeout(() => {
                        const ctx = document.getElementById(gid);
                        if(charts[gid]) charts[gid].destroy();
                        charts[gid] = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: logs.map(l=>l.date),
                                datasets: [{ label: athlete, data: logs.map(l=>l.score), borderColor: type==='Practice'?'#10b981':'#ef4444', tension: 0.3 }]
                            }
                        });
                    }, 200);
                }
            }
        }
    });

    // Global Review Logic
    function submitReview() {
        const n = document.getElementById('revName').value;
        const t = document.getElementById('revText').value;
        if(n && t) db.ref(`GLOBAL_FEEDBACKS`).push({ name: n, text: t, role: document.getElementById('revRole').value });
    }

    db.ref(`GLOBAL_FEEDBACKS`).on('value', snap => {
        const wall = document.getElementById('reviewWall');
        document.getElementById('revCount').innerText = snap.numChildren();
        wall.innerHTML = '';
        snap.forEach(c => {
            const v = c.val();
            wall.innerHTML = `<div class="card"><b>${v.name} (${v.role})</b><p>${v.text}</p></div>` + wall.innerHTML;
        });
    });
</script>
</body>
</html>
